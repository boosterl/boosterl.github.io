<!DOCTYPE html>
<html><head lang="en">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Running x86_64 Software on RISC-V Using Box64 - The World Beyond Linux</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="In this post I will give an overview on how a ran some software compiled for x86_64 on my RISC-V SBC, a MangoPi MQ-Pro. We will be using an awesome piece of software called Box64." />
	<meta property="og:image" content=""/>
	<meta property="og:url" content="https://worldbeyondlinux.be/posts/running-x86-64-software-on-riscv-using-box64/">
  <meta property="og:site_name" content="The World Beyond Linux">
  <meta property="og:title" content="Running x86_64 Software on RISC-V Using Box64">
  <meta property="og:description" content="In this post I will give an overview on how a ran some software compiled for x86_64 on my RISC-V SBC, a MangoPi MQ-Pro. We will be using an awesome piece of software called Box64.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-09-19T18:44:12+02:00">
    <meta property="article:modified_time" content="2022-09-19T18:44:12+02:00">
    <meta property="article:tag" content="Mangopi-Mq-Pro">
    <meta property="article:tag" content="Risc-V">
    <meta property="article:tag" content="Box64">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Running x86_64 Software on RISC-V Using Box64">
  <meta name="twitter:description" content="In this post I will give an overview on how a ran some software compiled for x86_64 on my RISC-V SBC, a MangoPi MQ-Pro. We will be using an awesome piece of software called Box64.">

        <link href="https://worldbeyondlinux.be/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://worldbeyondlinux.be/css/main.7a5c05040394322612a2d98397e9932aa81d9d7acc70199463e79f8180c8e0c0.css" />
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://worldbeyondlinux.be/">The World Beyond Linux</a>
	</div>
	<nav>
		
		<a href="/">Home</a>
		
		<a href="/posts">All posts</a>
		
		<a href="/tags">Tags</a>
		
		
	</nav>
</header>

<main>
  <article>
    <div class="post-container">
      
      <div class="post-content">
        <div class="title">
          <h1 class="title">Running x86_64 Software on RISC-V Using Box64</h1>
          <div class="meta">Posted on Sep 19, 2022</div>
        </div>
        
        <section class="body">
          <p>In this post I will give an overview on how a ran some software compiled for x86_64 on my RISC-V SBC, a <a href="https://mangopi.cc/mangopi_mqpro">MangoPi MQ-Pro</a>.
We will be using an awesome piece of software called <a href="https://github.com/ptitSeb/box64/">Box64</a>.
Basically this software runs x86_64 binaries through an emulator, but with a twist; it uses the native versions of some &ldquo;system&rdquo; libraries, like libc, libm, SDL, and OpenGL, like described in the README of the project:</p>
<pre tabindex="0"><code>Since Box64 uses the native versions of some &#34;system&#34; libraries, like libc,
libm, SDL, and OpenGL, it&#39;s easy to integrate and use with most applications,
and performance can be surprisingly high in many cases.
</code></pre><p>I have already tried the software on my RaspberryPi, both on an aarch64 and armv7 kernel (for the armv7 kernel, I used <a href="https://github.com/ptitSeb/box86">Box86</a>, which is for 32bit applications), but I saw Box64 was not limited to the ARM architecture. Other architectures like PowerPC 64 LE, LoongArch and, the one we are interested in, RISC-V, are also supported. So I decided to take it for a spin on my MangoPi MQ-Pro.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>You need to install a few build-dependencies on the Linux distribution you&rsquo;re running on your RISC-V board, namely <code>cmake</code>, <code>git</code> and <code>python</code>.
I used the awesome <a href="https://github.com/sehraf/riscv-arch-image-builder">Arch Linux build</a> from <a href="https://github.com/sehraf">sehraf</a>.
On that distribution I installed the dependencies with pacman like so:</p>
<pre tabindex="0"><code>sudo pacman -S base-devel cmake git python3
</code></pre><p>Another nice-to have is binfmt_misc kernel support. This allows x86_64 to be started directly from the shell, like you would execute any other binary.
More information can be found <a href="https://docs.kernel.org/admin-guide/binfmt-misc.html">here</a>.
Support for this feature can be checked by executing:</p>
<pre tabindex="0"><code>cat /proc/sys/fs/binfmt_misc/status
</code></pre><p>This should output <code>enabled</code> if this feature is supported.
If the system complains about a directory which does not exist, support is not enabled.
Sheraf&rsquo;s Arch Linux build, which I referenced earlier, has support for binfmt_misc.
Support for this is not an absolute necessity however, you can also ran x86_64 binaries by executing <code>box64 $BINARY</code>.</p>
<h2 id="compiling">Compiling</h2>
<p>Compiling the software is pretty easy when all the build dependencies are installed.
It&rsquo;s just a case of cloning the repo, compiling and installing it, and as a last step restarting the binfmt systemd-service (so that systemd-binfmt is aware that x86_64 binaries can be executed via Box64).
Like I said in the prerequisites section, binfmt-support is optional.
The compile/install steps like described in the <a href="https://github.com/ptitSeb/box64/blob/main/docs/COMPILE.md#for-risc-v">compiling docs</a> of Box64:</p>
<pre tabindex="0"><code>git clone https://github.com/ptitSeb/box64
cd box64
mkdir build; cd build; cmake .. -DRV64=1 -DCMAKE_BUILD_TYPE=RelWithDebInfo
make -j`nproc`
sudo make install

sudo systemctl restart systemd-binfmt
</code></pre><h2 id="simple-test">Simple test</h2>
<p>To take box64 for a spin for the first time, we will write a very simple C-program on a x86_64 machine, and run the binary on our RISC-V machine.
For this test you will need a C-compiler (I will use gcc) and make sure x86_64 is the target.
Our C-program looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hello.c" data-lang="hello.c"><span style="display:flex;"><span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Hello, world!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>We can then compile this program with gcc using:</p>
<pre tabindex="0"><code>gcc -Wall hello.c -o hello
</code></pre><p>Executing this program on a x86_64, Linux machine should not be a problem:</p>
<pre tabindex="0"><code>./hello
Hello, world!
</code></pre><p>Now we will transfer the program to our RISC-V machine. You can use tools like <code>scp</code> for this when your RISC-V machine is on the same network.
Also, make sure the binary is executable: <code>chmod +x hello</code>.
Then you should be able to just run the binary on your RISC-V machine:</p>
<pre tabindex="0"><code>$ ./hello 
Box64 v0.1.9 21c56e7 built on Sep 16 2022 17:30:02
Using default BOX64_LD_LIBRARY_PATH: ./:lib/:lib64/:x86_64/:bin64/:libs64/
Using default BOX64_PATH: ./:bin/
Counted 22 Env var
Looking for ./hello
Rename process to &#34;hello&#34;
Using native(wrapped) libc.so.6
Using native(wrapped) ld-linux-x86-64.so.2
Using native(wrapped) libpthread.so.0
Using native(wrapped) librt.so.1
Hello, world!
</code></pre><p>If you don&rsquo;t have binfmt-support, you can still run the program like this:</p>
<pre tabindex="0"><code>box64 ./hello
</code></pre><p>And you should see the same output.</p>
<p>And voila, we have run our first x86_64-binary on a RISC-V machine!
If you want, you can also hide the log messages and Box64 banner, so no one would know you&rsquo;re actually running a x86_64 binary:</p>
<pre tabindex="0"><code>$ BOX64_NOBANNER=1 BOX64_LOG=0 ./hello 
Hello, world!
</code></pre><h2 id="harder-test">Harder test</h2>
<p>As a harder test I wanted to try out <a href="https://multitheftauto.com/">Multi Theft Auto</a>.
This is an Open Source server for an all time favorite game of mine; GTA: San Andreas.
I already successfully ran this software via Box64 on a Raspberry Pi, so it was a good candidate to test on my RISC-V board.
To install it, I just followed the <a href="https://wiki.multitheftauto.com/wiki/Installing_and_Running_MTASA_Server_on_GNU_Linux#Installation_64_bit">instructions</a> posted on their website.
There does appear to be an issue with the ncurses library that&rsquo;s being used by MTA in combination with Box64.
But when running the software without ncurses with the <code>-n</code> argument, the software eventually starts without any issues:</p>
<pre tabindex="0"><code>$ BOX64_NOBANNER=1 BOX64_LOG=0 ./mta-server64 -n
Warning, function myw_wprintw not found
MTA:BLUE Server for MTA:SA

==================================================================
= Multi Theft Auto: San Andreas v1.5.9 [64 bit]
==================================================================
= Server name      : RISC-test
= Server IP address: auto
= Server port      : 22003
= 
= Log file         : ..o_linux_x64/mods/deathmatch/logs/server.log
= Maximum players  : 32
= HTTP port        : 22005
= Voice Chat       : Disabled
= Bandwidth saving : Medium
==================================================================
[16:56:48] Resources: 194 loaded, 0 failed
[16:56:49] Server password set to &#39;******&#39;
[16:56:49] Starting resources...
[16:57:14] Server minclientversion is now 1.5.9-9.21261.0
[16:58:10] Gamemode &#39;play&#39; started.
[16:58:10] Querying MTA master server... success! (Auto detected IP:94.110.54.172)
[16:58:10] Authorized serial account protection is DISABLED. See http://mtasa.com/authserial
[16:58:10] WARNING: &lt;owner_email_address&gt; not set
[16:58:10] Server started and is ready to accept connections!
[16:58:10] To stop the server, type &#39;shutdown&#39; or press Ctrl-C
[16:58:10] Type &#39;help&#39; for a list of commands.
</code></pre><h2 id="going-further">Going further</h2>
<p>The two tests in this article were very basic.
With Box64 on RISC-V a world of opportunities opens up; running software written for Windows using Wine, running GUI applications&hellip;
But those are things for another day.</p>

        </section>
        <div class="post-tags">
          
          
          <nav class="nav tags">
            <ul class="tags">
              
              <li><a href="/tags/mangopi-mq-pro">mangopi-mq-pro</a></li>
              
              <li><a href="/tags/risc-v">risc-v</a></li>
              
              <li><a href="/tags/box64">box64</a></li>
              
            </ul>
          </nav>
          
          
        </div>
      </div>

      
      
    </div>

    </article>
</main>
<footer>
  <div style="display:flex"><a class="soc" href="https://github.com/boosterl" rel="me" title="Github"><svg class="feather">
       <use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#github" />
    </svg></a><a class="border"></a></div>
  <div class="footer-info">
    2025  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>



</div>
    </body>
</html>
